<!-- navbar.html -->
<nav class="navbar">
    <a href="index.html" class="nav-logo">
        <img src="assets/logo.webp" alt="zStudio Logo" class="logo-icon" />
        zStudio
    </a>
    <div class="nav-links">
        <a href="index.html" class="nav-link">Home</a>
        <a href="zImporter.html" class="nav-link">Usage</a>
        <a href="about.html" class="nav-link">About</a>
        <a href="tutorials.html" class="nav-link">Tutorials</a>
        <a href="docs/index.html" class="nav-link">Importer Docs</a>
        <a href="dashboard.html" class="nav-link">Login</a>
    </div>
</nav>

<script>
    // Cache busting for navbar links
    document.addEventListener('DOMContentLoaded', () => {
        const links = document.querySelectorAll('.nav-links a');
        links.forEach(link => {
            try {
                const url = new URL(link.getAttribute('href'), window.location.origin);
                url.searchParams.set('cb', Date.now());
                link.setAttribute('href', url.pathname + url.search);
            } catch (error) {
                console.error('Error processing link:', link, error);
            }
        });
    });
</script>

<script>
    // Inline auth functions for reliability
    if (!window.isLoggedIn) {
        window.isLoggedIn = () => {
            return localStorage.getItem('loggedIn') === 'true';
        };

        window.setLoggedIn = (status) => {
            localStorage.setItem('loggedIn', status ? 'true' : 'false');
        };

        window.setUserEmail = (email) => {
            localStorage.setItem('userEmail', email);
        };

        window.apiLogin = async (email, password) => {
            console.log('Logging in with:', email, password);
            return { success: true, user: { email } };
        };
    }

    // Update navbar link based on login status
    const updateNavbar = async () => {
        const loginLink = document.querySelector('.nav-links a[href="dashboard.html"]');
        if (loginLink) {
            let loggedIn = window.isLoggedIn();
            if (!loggedIn && !window.location.href.includes('dashboard.html')) {
                // Try auto-login if credentials stored
                const storedEmail = localStorage.getItem('storedEmail');
                const storedPassword = localStorage.getItem('storedPassword');
                if (storedEmail && storedPassword) {
                    try {
                        const result = await window.apiLogin(storedEmail, storedPassword);
                        if (result.success) {
                            window.setLoggedIn(true);
                            window.setUserEmail(storedEmail);
                            loggedIn = true;
                            console.log('Auto-login successful');
                        }
                    } catch (error) {
                        console.error('Auto-login failed:', error);
                    }
                }
            }
            if (loggedIn) {
                loginLink.textContent = 'My Dashboard';
            } else {
                loginLink.textContent = 'Login';
            }
        }
    };

    updateNavbar();
</script>